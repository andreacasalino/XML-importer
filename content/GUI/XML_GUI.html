<!doctype html>
<html>
<head>
  <title>XML GUI</title>

  <script type="text/javascript" src="vis-4.21.0/dist/vis.js"></script>
  <link href="vis-4.21.0/dist/vis-network.min.css" rel="stylesheet" type="text/css" />

  <style type="text/css">
    #mynetwork {
      width:  950px;
      height: 800px;
	  border: 1px solid #444444;
      background-color: #C9E7DA;
    }
	
	#mex_area {
      border: 1px solid lightgray;
    }
	
	#command_area {
      border: 1px solid lightgray;
    }
  </style>

Location to import: <div id="mex_big_area">
<div id="mex_area"></div>
<button id="mex_button" type="button">Import</button>	
<button id="exporter_button" type="button">Export</button>
<div id="interaction_area"></div>
<div id="command_area"></div>
<button id="deleter_button" type="button">Delete</button>
<button id="name_modif_button" type="button">Set name</button>
<button id="val_modif_button" type="button">Set value</button>
<button id="tag_creator_button" type="button">Create sub tag</button>
<button id="field_creator_button" type="button">Create field</button>
</div> 
<div id="mynetwork"></div>
	
</head>

<body>


<script type="text/javascript">

	var server_key='-';
	window.onload = function winopen(){ 
		server_key = get_Response('hello'); 
	}; 
	
	var mex_button = document.getElementById('mex_button');
	var mex_area = document.getElementById('mex_area');
	mex_area.contentEditable = "true";
	
	var last_element_selected = '-1';
	var command_area = document.getElementById('command_area');
	command_area.contentEditable = "true";
	var deleter_button = document.getElementById('deleter_button');
	var name_modif_button = document.getElementById('name_modif_button');
	var val_modif_button = document.getElementById('val_modif_button');
	var tag_creator_button = document.getElementById('tag_creator_button');
	var field_creator_button = document.getElementById('field_creator_button');
	var exporter_button = document.getElementById('exporter_button');
	
	var container = document.getElementById('mynetwork');
	var options = {
		layout: {
			hierarchical: {
				direction: "UD"
			}
		},
		nodes: {font: {color: '#ffffff'}},
		interaction:{hover:true, selectable: true}	
	};
	
	var network = null;
	
	function destroy() {
		if (network !== null) {
			network.destroy();
			network = null;
		}
	}
	
	get_Response = function(request_message){
		let xhr = new XMLHttpRequest();
		var last_JSON_arrived;
		xhr.open('GET', 'http://localhost:8080', false);
		xhr.setRequestHeader('Accept', server_key + '_' + request_message);
		
		xhr.send();
		return xhr.response;
	}
	
	function Update_network(new_net){
		  var data = JSON.parse(new_net);
			
		  destroy();
		  network = new vis.Network(container, data, options);
		  
			network.on("click", function (params) {
				params.event = "[original event]";
				last_element_selected = params.nodes[0];
			}
			);
			
			network.on("deselectNode", function (params) {
				last_element_selected = '-1';
			});	
	
	}
	
	mex_button.onclick = function() {
          destroy();
		  
		  var path = mex_area.textContent;
		  
		  //send new XML to parse
		  var resp = get_Response('X_' + path);
		  if(resp === "null"){		  
				return;
		  }
		  last_element_selected = '-1';
		  
		  Update_network(resp);
	}
	
	window.onbeforeunload = function () {
		get_Response('close'); //closure command to server
	};
	
	deleter_button.onclick = function (){
		//alert(last_element_selected);
		if(last_element_selected === '-1' ){
			alert('select something to delete');
			return;
		}
		
		var resp = get_Response('D_' + last_element_selected);
		last_element_selected = '-1'; 
		  if(resp === "null"){		 
				return;
		  }
		  
		 Update_network(resp);
	}
	
	name_modif_button.onclick = function (){
		//alert(last_element_selected);
		var new_name = command_area.textContent;
		if(new_name === '' ){
			alert('insert a name');
			return;
		}
		if(last_element_selected === '-1' ){
			alert('select an element whose name must be changed');
			return;
		}
		
		var resp = get_Response('S_N_' + last_element_selected + '*' + new_name);
		last_element_selected = '-1'; 
		  if(resp === "null"){		 
				return;
		  }
		  
		 Update_network(resp);
	}

	val_modif_button.onclick = function (){
		//alert(last_element_selected);
		var new_name = command_area.textContent;
		if(new_name === '' ){
			alert('insert a value');
			return;
		}
		if(last_element_selected === '-1' ){
			alert('select an element whose value must be changed');
			return;
		}
		
		var resp = get_Response('S_V_' + last_element_selected + '*' + new_name);
		last_element_selected = '-1'; 
		  if(resp === "null"){		 
				alert('invalid element selected');
				return;
		  }
		  
		 Update_network(resp);
	}
	
	tag_creator_button.onclick = function (){
		//alert(last_element_selected);
		var new_element_name = command_area.textContent;
		if(new_element_name === '' ){
			alert('insert a name for the tag to create');
			return;
		}
		if(last_element_selected === '-1' ){
			alert('select an element whose value must be changed');
			return;
		}
		
		var resp = get_Response('T_' + last_element_selected + '*' + new_element_name);
		last_element_selected = '-1'; 
		  if(resp === "null"){		 
				alert('invalid element to add');
				return;
		  }
		  
		 Update_network(resp);
	}
	
	field_creator_button.onclick = function (){
		//alert(last_element_selected);
		var new_element_name = command_area.textContent;
		if(new_element_name === '' ){
			alert('insert a name for the field to create');
			return;
		}
		if(last_element_selected === '-1' ){
			alert('select an element whose value must be changed');
			return;
		}
		
		var resp = get_Response('F_' + last_element_selected + '*' + new_element_name);
		last_element_selected = '-1'; 
		  if(resp === "null"){		 
				alert('invalid element to add');
				return;
		  }
		  
		 Update_network(resp);
	}
	
	exporter_button.onclick = function (){
		//alert(last_element_selected);
		var file_location = mex_area.textContent;
		if(file_location === '' ){
			return;
		}
		
		get_Response('E_' + file_location);
	}
	
</script>


</body>
</html>
