<html>
    <head>
        <div id="page"></div>
        <style>
            body{
                padding: 0px;
                margin: 0px;
                display: flex;
                background-color: gray;
                text-align: center;
            }
            .div{
                width: 100%;
                height: 100%;
                padding: 0px;
                margin: 0px;
            }

            .bord{
                border-style: solid;
                border-color: "black";
                border-width: 2px;
            }
        </style>

        <script src="./src/JS/vis-4.21.0/dist/vis.js"></script>
        <link href="./src/JS/vis-4.21.0/dist/vis-network.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <script src="./src/JS/my_src/divisions.js"></script>
        <script src="./src/JS/my_src/buttons.js"></script>
        <script src="./src/JS/my_src/connection.js"></script>

        <script>
            let C = document.createElement("div");
            document.body.appendChild(C);
            C.style.width = "15%";
            C.style.minWidth = "200px";

            let B = document.createElement("div");
            document.body.appendChild(B);
            B.style.width = "85%";
            B.style.backgroundColor = "white";
            B.setAttribute("class" , "bord");

            let B_author = document.createElement("div");
            B.appendChild(B_author);
            B_author.style.height = "50px";
            B_author.innerHTML = "Author: Andrea Casalino. Reports any bug to andrecasa91@gmail.com";

            let B_canvas = document.createElement("div");
            B.appendChild(B_canvas);
            B_canvas.style.height = "1000px";

            let btn_Import = get_button("img/Import.svg", "Import new structure");
            C.appendChild(btn_Import);
            btn_Import.addEventListener("click" , function(){
                let file_location = prompt("Enter the location of the file (pass null to create an empty structure)", "../Examples/Ex_02/XML_example_02.xml");
                Conn.send_command(file_location, "I");
            });
            
            let btn_Export = get_button("img/Export.svg", "Save the actual structure");
            C.appendChild(btn_Export);
            btn_Export.addEventListener("click" , function(){
                let file_location = prompt("Enter the location where you want to save the structure", "./prova_export.xml");
                Conn.send_command(file_location, "E");
            });

            let btns_temp = [];

            function deactivate_btns(){
                for(let i=0; i<btns_temp.length; i++){
                    C.removeChild(btns_temp[i]);
                }
                btns_temp = [];
            }

            function activate_tag_actions(){
                let btn_temp = get_button("img/Delete.svg", "Delete selected");
                C.appendChild(btn_temp);
                btns_temp.push(btn_temp);
                btn_temp.style.marginTop = "50px";
                btn_temp.addEventListener("click" , function(){ Conn.send_command("d", "D"); });

                btn_temp = get_button("img/Rename.svg", "Rename selected");
                C.appendChild(btn_temp);
                btns_temp.push(btn_temp);
                btn_temp.addEventListener("click" , function(){ 
                let new_name = prompt("Enter the new name", "new_name");
                    Conn.send_command(new_name, "N"); 
                });
                
                btn_temp = get_button("img/New_tag.svg", "Create nested tag");
                C.appendChild(btn_temp);
                btns_temp.push(btn_temp);
                btn_temp.addEventListener("click" , function(){ 
                let new_tag = prompt("Enter the name of new tag", "new_tag");
                    Conn.send_command(new_tag, "T"); 
                });
                
                btn_temp = get_button("img/New_attribute.svg", "Create new attribute");
                C.appendChild(btn_temp);
                btns_temp.push(btn_temp);
                btn_temp.addEventListener("click" , function(){ 
                let new_attr = prompt("Enter the name of new attribute", "new_attr");
                    Conn.send_command(new_attr, "A"); 
                });
            };
            
            function activate_attribute_actions(){
                let btn_temp = get_button("img/Delete.svg", "Delete selected");
                C.appendChild(btn_temp);
                btns_temp.push(btn_temp);
                btn_temp.style.marginTop = "50px";
                btn_temp.addEventListener("click" , function(){ Conn.send_command("d", "D"); });

                btn_temp = get_button("img/Rename.svg", "Rename selected");
                C.appendChild(btn_temp);
                btns_temp.push(btn_temp);
                btn_temp.addEventListener("click" , function(){ 
                let new_name = prompt("Enter the new name", "new_name");
                    Conn.send_command(new_name, "N"); 
                });
                
                btn_temp = get_button("img/Set_value.svg", "Change value of selected");
                C.appendChild(btn_temp);
                btns_temp.push(btn_temp);
                btn_temp.addEventListener("click" , function(){ 
                let new_val = prompt("Enter the new value", "new_value");
                    Conn.send_command(new_val, "V"); 
                });
            };

            var Conn = new Connection(B_canvas , deactivate_btns, activate_tag_actions, activate_attribute_actions);

            window.addEventListener("beforeunload", function(e) { 
                prompt("Insert", "something");
                Conn.send_command("k", "K"); 

                function wait(ms){
                    let start = new Date().getTime();
                    let end = start;
                    while(end < start + ms) {
                        end = new Date().getTime();
                    }
                }
                wait(1300);

            }, false);

        </script>
    </body>
</html>